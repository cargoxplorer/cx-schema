{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Workflow Mapping",
  "description": "Input/output mapping patterns for workflow data flow",
  "definitions": {
    "outputMapping": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "description": "Output variable name"
        },
        "mapping": {
          "type": "string",
          "description": "Path to extract value from result"
        }
      },
      "required": ["name", "mapping"],
      "additionalProperties": false
    },
    "variableMapping": {
      "oneOf": [
        {
          "type": "string",
          "description": "Simple template expression"
        },
        {
          "type": "object",
          "properties": {
            "expression": {
              "type": "string",
              "description": "NCalc expression"
            }
          },
          "additionalProperties": true
        },
        {
          "type": "object",
          "properties": {
            "switch": {
              "type": "object",
              "properties": {
                "expression": {
                  "type": "string"
                }
              }
            },
            "cases": {
              "type": "object",
              "additionalProperties": true
            },
            "default": {}
          }
        },
        {
          "type": "object",
          "properties": {
            "extends": {
              "type": "string",
              "description": "Extend an existing object"
            },
            "defaultIfNull": {},
            "mapping": {}
          }
        },
        {
          "type": "object",
          "properties": {
            "foreach": {
              "type": "string",
              "description": "Collection to iterate"
            },
            "mapping": {
              "type": "object",
              "additionalProperties": true
            }
          }
        },
        {
          "type": "object",
          "properties": {
            "coalesce": {
              "type": "array",
              "items": {},
              "description": "Return first non-null value"
            }
          }
        }
      ]
    },
    "pathExpression": {
      "type": "string",
      "description": "Dot-notation path to access nested values",
      "x-examples": [
        "activityName.stepName.outputVariable",
        "orders.items?[0]?.jobs[0]?.jobId",
        "order?.customValues?.isConsolidated?",
        "orders?[orderType=\"ParcelShipment\"]?[0]?",
        "carriers[contactId=(carrierId)]",
        "charges[applyToContactId=(carrierId)]",
        "commodities[**]",
        "commodities[**][-1]"
      ]
    }
  },
  "x-examples": {
    "simpleMapping": {
      "name": "orderId",
      "mapping": "getOrder.order.orderId"
    },
    "safeNavMapping": {
      "name": "customValue",
      "mapping": "order?.customValues?.value?"
    },
    "templateMapping": "Order_{{ order.orderNumber }}.pdf",
    "switchMapping": {
      "switch": {
        "expression": "[orderType]"
      },
      "cases": {
        "Air": "air-template",
        "Ocean": "ocean-template"
      },
      "default": "default-template"
    },
    "foreachMapping": {
      "foreach": "items?",
      "mapping": {
        "id": "{{ item.id }}",
        "name": "{{ item.name }}"
      }
    }
  }
}
