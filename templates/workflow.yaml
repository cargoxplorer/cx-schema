# {{displayName}} Workflow
# Generated by cx-validate create workflow

workflow:
  workflowId: "{{uuid}}"
  name: "{{displayName}}"
  description: "{{displayName}} workflow"
  version: "1.0"
  executionMode: Async
  logLevel: Information
  isActive: true
  enableAudit: true
  fileName: "{{fileName}}"
  tags:
    - "generated"

inputs:
  - name: entityId
    type: text
    props:
      displayName: "Entity ID"
      description: "The ID of the entity to process"
      required: true

outputs:
  - name: result
    mapping: "processResult"

variables:
  - name: processResult
    value: null

activities:
  - name: Main
    steps:
      - task: "Log@1"
        name: LogStart
        inputs:
          message: "Starting {{displayName}} workflow for entity: \{{inputs.entityId}}"
          level: Information

      - task: "Query/GraphQL"
        name: GetEntity
        inputs:
          query: |
            query GetEntity($id: ID!) {
              entity(id: $id) {
                id
                name
                status
              }
            }
          variables:
            id: "\{{inputs.entityId}}"

      - task: "switch"
        name: CheckStatus
        expression: "getData.entity.status"
        cases:
          - value: "active"
            steps:
              - task: "Log@1"
                name: LogActive
                inputs:
                  message: "Entity is active, processing..."
                  level: Information

          - value: "inactive"
            steps:
              - task: "Log@1"
                name: LogInactive
                inputs:
                  message: "Entity is inactive, skipping..."
                  level: Warning

        default:
          - task: "Log@1"
            name: LogUnknown
            inputs:
              message: "Unknown status: \{{getData.entity.status}}"
              level: Warning

      - task: "SetVariable@1"
        name: SetResult
        inputs:
          name: processResult
          value:
            success: true
            entityId: "\{{inputs.entityId}}"
            processedAt: "\{{now()}}"

      - task: "Log@1"
        name: LogEnd
        inputs:
          message: "Completed {{displayName}} workflow"
          level: Information

triggers:
  - type: Manual
    name: ManualTrigger
